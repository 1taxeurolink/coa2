<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aero Congress 2025 - Certificat de Participare</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; background-image: radial-gradient(circle at top right, #c3daff 0%, #f0f2f5 50%); -webkit-font-smoothing: antialiased; }
        .glass-container { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid #e5e7eb; }
        .modal.hidden { display: none; }
        .lang-btn { opacity: 0.6; transition: opacity 0.2s, transform 0.2s; transform: scale(0.9); }
        .lang-btn.active, .lang-btn:hover { opacity: 1; transform: scale(1); }
        .spinner { border-top-color: transparent; width: 20px; height: 20px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 text-gray-800">

    <a href="admin.html" class="absolute top-4 right-4 p-2 rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transition" aria-label="Admin Panel" data-translate-key="admin_panel_button" title="Panou Administrare">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.96.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106.96-.54 2.042.061 2.287.947.379 1.561 2.6 1.561 2.978 0a1.532 1.532 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106-.54-.96-.061-2.042.947-2.287 1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
    </a>

    <div id="app" class="w-full max-w-7xl mx-auto flex flex-col flex-grow justify-center">
        <header class="text-center mb-8">
            <div id="lang-switcher" class="flex justify-center items-center gap-3 mb-4">
                <button data-lang="ro" class="lang-btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24" width="24" height="16" class="rounded-sm shadow-md pointer-events-none"><path fill="#002B7F" d="M0 0h12v24H0z"/><path fill="#FCD116" d="M12 0h12v24H12z"/><path fill="#CE1126" d="M24 0h12v24H24z"/></g></svg></button>
                <button data-lang="en" class="lang-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="16" class="rounded-sm shadow-md pointer-events-none" viewBox="0 0 72 48"><path fill="#B31942" d="M0 0h72v48H0z"/><path fill="#fff" d="M0 4.8h72v4.8H0zm0 9.6h72v4.8H0zm0 9.6h72v4.8H0zm0 9.6h72v4.8H0zm0 9.6h72v4.8H0z"/><path fill="#0A3161" d="M0 0h36v28.8H0z"/><path fill="#fff" d="m6 3.6 1.1.8L8 3.6V2.4l-1 .7-.9-.7zm6 0 1.1.8L14 .8V2.4l-1 .7-.9-.7zm6 0 1.1.8L20 .8V2.4l-1 .7-.9-.7zm6 0 1.1.8L26 .8V2.4l-1 .7-.9-.7zm6 0 1.1.8L32 .8V2.4l-1 .7-.9-.7zm-27 4.8.9.8L2 8.4V7.2l1 .7 1-.7zm6 0 .9.8L8 8.4V7.2l1 .7 1-.7zm6 0 .9.8L14 8.4V7.2l1 .7 1-.7zm6 0 .9.8L20 8.4V7.2l1 .7 1-.7zm6 0 .9.8L26 8.4V7.2l1 .7 1-.7zm-27 4.8.9.8L2 13.2V12l1 .7 1-.7zm6 0 .9.8L8 13.2V12l1 .7 1-.7zm6 0 .9.8L14 13.2V12l1 .7 1-.7zm6 0 .9.8L20 13.2V12l1 .7 1-.7zm6 0 .9.8L26 13.2V12l1 .7 1-.7zm-27 4.8.9.8L2 18V16.8l1 .7 1-.7zm6 0 .9.8L8 18V16.8l1 .7 1-.7zm6 0 .9.8L14 18V16.8l1 .7 1-.7zm6 0 .9.8L20 18V16.8l1 .7 1-.7zm6 0 .9.8L26 18V16.8l1 .7 1-.7z"/></svg></button>
                <button data-lang="fr" class="lang-btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24" width="24" height="16" class="rounded-sm shadow-md pointer-events-none"><path fill="#002395" d="M0 0h12v24H0z"/><path fill="#FFF" d="M12 0h12v24H12z"/><path fill="#ED2939" d="M24 0h12v24H24z"/></svg></button>
            </div>
            <img src="https://placehold.co/300x80/0d47a1/FFFFFF?text=Aero+Congress" alt="Conference Logo" class="h-16 mx-auto mb-4">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800" data-translate-key="main_title">Aero Congress 2025</h1>
            <p class="text-gray-600 mt-2" data-translate-key="main_subtitle">DescÄƒrcare Certificat de Participare</p>
            <p class="text-sm text-gray-500 mt-2" data-translate-key="main_instructions">IntroduceÈ›i cel puÈ›in douÄƒ cÃ¢mpuri pentru a gÄƒsi certificatul.</p>
        </header>

        <main id="main-content" class="w-full max-w-lg mx-auto">
            <div id="search-view">
                <div class="glass-container p-8 rounded-2xl shadow-lg">
                    <h2 class="text-xl font-semibold text-center mb-6 text-gray-700" data-translate-key="search_title">CÄƒutare Participant</h2>
                    <form id="search-form" novalidate>
                        <div class="space-y-4">
                            <div><label for="fullName" class="block text-sm font-medium mb-1" data-translate-key="fullname_label">Nume complet</label><input type="text" id="fullName" class="w-full px-4 py-2 border rounded-lg bg-white/50" data-translate-key="fullname_placeholder" placeholder="ex: Robert Diaconu"></div>
                            <div><label for="email" class="block text-sm font-medium mb-1" data-translate-key="email_label">AdresÄƒ Email</label><input type="email" id="email" class="w-full px-4 py-2 border rounded-lg bg-white/50" data-translate-key="email_placeholder" placeholder="ex: robert@gmail.com"></div>
                            <div><label for="regNumber" class="block text-sm font-medium mb-1" data-translate-key="regnumber_label">NumÄƒr Ã®nregistrare</label><input type="text" id="regNumber" inputmode="numeric" class="w-full px-4 py-2 border rounded-lg bg-white/50" data-translate-key="regnumber_placeholder" placeholder="ex: 12345"></div>
                        </div>
                        <button id="search-button" type="submit" class="w-full mt-6 bg-blue-700 text-white font-semibold py-3 rounded-lg hover:bg-blue-800 active:scale-95 transition-all shadow-md flex items-center justify-center gap-2">
                             <span id="search-button-icon"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg></span>
                             <span data-translate-key="search_button">DescarcÄƒ Certificat</span>
                        </button>
                    </form>
                </div>
            </div>
            <div id="result-view" class="hidden"></div>
        </main>
    </div>
    
    <footer class="text-center p-4 mt-auto">
        <div id="datetime-container" class="text-sm text-gray-500"></div>
    </footer>

    <div id="message-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // ðŸš€ START: Configurare Supabase
    const SUPABASE_URL = 'https://pgnrxhgosbiqstzbctkf.supabase.co'; // ðŸ‘ˆ ÃŽNLOCUIEÈ˜TE AICI
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnbnJ4aGdvc2JpcXN0emJjdGtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyMTQ0MzgsImV4cCI6MjA2NDc5MDQzOH0.N6eucwdtqL2PST7f7PQVqlMhYMpJOvqfLkt-VGf6YMQ'; // ðŸ‘ˆ ÃŽNLOCUIEÈ˜TE AICI
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    // ðŸš€ END: Configurare Supabase

    const translations = {
        main_title: { ro: "Aero Congress 2025", en: "Aero Congress 2025", fr: "Aero Congress 2025" },
        main_subtitle: { ro: "DescÄƒrcare Certificat de Participare", en: "Download Certificate of Participation", fr: "TÃ©lÃ©charger le Certificat de Participation" },
        main_instructions: { ro: "IntroduceÈ›i cel puÈ›in douÄƒ cÃ¢mpuri pentru a gÄƒsi certificatul.", en: "Enter at least two fields to find the certificate.", fr: "Entrez au moins deux champs pour trouver le certificat." },
        search_title: { ro: "CÄƒutare Participant", en: "Participant Search", fr: "Recherche de Participant" },
        fullname_label: { ro: "Nume complet", en: "Full Name", fr: "Nom Complet" }, fullname_placeholder: { ro: "ex: Robert Diaconu", en: "e.g., John Doe", fr: "ex: Jean Dupont" },
        email_label: { ro: "AdresÄƒ Email", en: "Email Address", fr: "Adresse E-mail" }, email_placeholder: { ro: "ex: robert@gmail.com", en: "e.g., john.doe@email.com", fr: "ex: jean.dupont@email.com" },
        regnumber_label: { ro: "NumÄƒr Ã®nregistrare", en: "Registration Number", fr: "NumÃ©ro d'Enregistrement" }, regnumber_placeholder: { ro: "ex: 12345", en: "e.g., 12345", fr: "ex: 12345" },
        search_button: { ro: "DescarcÄƒ Certificat", en: "Download Certificate", fr: "TÃ©lÃ©charger le Certificat" }, 
        download_button: { ro: "DescarcÄƒ", en: "Download", fr: "TÃ©lÃ©charger"}, 
        back_button: { ro: "CÄƒutare NouÄƒ", en: "New Search", fr: "Nouvelle Recherche" }, 
        admin_panel_button: {ro: "Panou Administrare", en: "Admin Panel", fr: "Panneau d'admin"},
        modal_error_title: { ro: "Date Incorecte", en: "Incorrect Data", fr: "DonnÃ©es Incorrectes" }, 
        modal_error_text: { ro: "Niciun participant nu a fost gÄƒsit. VÄƒ rugÄƒm sÄƒ verificaÈ›i datele.", en: "No participant found. Please check your details.", fr: "Aucun participant trouvÃ©. Veuillez vÃ©rifier vos informations." },
        modal_error_no_certificate: { ro: "Participant gÄƒsit, dar nu existÄƒ un certificat de descÄƒrcat.", en: "Participant found, but there is no certificate to download.", fr: "Participant trouvÃ©, mais il n'y a pas de certificat Ã  tÃ©lÃ©charger."},
        modal_error_not_enough_fields: { ro: "VÄƒ rugÄƒm sÄƒ completaÈ›i cel puÈ›in douÄƒ cÃ¢mpuri pentru cÄƒutare.", en: "Please fill at least two fields to search.", fr: "Veuillez remplir au moins deux champs pour la recherche." },
        modal_close_button: { ro: "ÃŽnchide", en: "Close", fr: "Fermer" },
        certificate_title: { ro: "Certificat de Participare", en: "Certificate of Participation", fr: "Certificat de Participation" },
        multiple_results_error: { ro: "S-au gÄƒsit mai mulÈ›i participanÈ›i. VÄƒ rugÄƒm adÄƒugaÈ›i È™i numele complet pentru a rafina cÄƒutarea.", en: "Multiple participants found. Please add the full name to refine the search.", fr: "Plusieurs participants trouvÃ©s. Veuillez ajouter le nom complet pour affiner la recherche."}
    };
    
    let currentLanguage = 'ro';
    
    const searchForm = document.getElementById('search-form');
    const messageModal = document.getElementById('message-modal');
    const langSwitcher = document.getElementById('lang-switcher');

    function setLanguage(lang) {
        currentLanguage = lang;
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            const translation = translations[key]?.[lang];
            if (translation) {
                if (el.hasAttribute('placeholder')) el.placeholder = translation;
                else if (el.hasAttribute('title')) el.title = translation;
                else el.textContent = translation;
            }
        });
        langSwitcher.querySelectorAll('button').forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang));
        updateClock();
    };

    function updateClock() { 
        const locale = currentLanguage === 'ro' ? 'ro-RO' : currentLanguage === 'en' ? 'en-GB' : 'fr-FR';
        document.getElementById('datetime-container').textContent = new Date().toLocaleString(locale, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }); 
    };

    function showMessage(titleKey, textKey) {
        const title = translations[titleKey]?.[currentLanguage] || titleKey;
        const text = translations[textKey]?.[currentLanguage] || textKey;
        messageModal.innerHTML = `<div class="bg-white max-w-sm w-full rounded-2xl shadow-xl p-8 text-center"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"><svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><h3 class="text-xl font-bold text-gray-800 mt-4 mb-2">${title}</h3><p class="text-gray-600 mb-6">${text}</p><button class="close-modal-btn bg-blue-700 text-white w-full py-2 rounded-lg hover:bg-blue-800">${translations.modal_close_button[currentLanguage]}</button></div>`;
        messageModal.classList.remove('hidden');
        messageModal.querySelector('.close-modal-btn').onclick = () => messageModal.classList.add('hidden');
    };
    
    function showResultView(delegate) {
        const resultView = document.getElementById('result-view');
        const downloadFileName = `Certificat-${delegate.firstName}-${delegate.lastName}.pdf`;
        resultView.innerHTML = `
            <div class="glass-container p-6 md:p-8 rounded-2xl shadow-lg text-center">
                <h2 class="text-2xl font-bold mb-2" data-translate-key="certificate_title">${translations.certificate_title[currentLanguage]}</h2>
                <p class="mb-6 text-lg font-medium">${delegate.firstName} ${delegate.lastName}</p>
                <div class="mb-6 border rounded-lg overflow-hidden bg-gray-100">
                    <iframe src="${delegate.certificateUrl}" class="w-full h-96 md:h-[500px]" title="Previzualizare Certificat"><p>Browserul dvs. nu suportÄƒ PDF-uri. PuteÈ›i <a href="${delegate.certificateUrl}">descÄƒrca fiÈ™ierul</a>.</p></iframe>
                </div>
                <div class="mt-6 flex flex-col sm:flex-row gap-4 justify-center">
                     <a href="${delegate.certificateUrl}" download="${downloadFileName}" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="download_button">${translations.download_button[currentLanguage]}</span>
                     </a>
                     <button id="back-button-result" class="bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-lg hover:bg-gray-300 flex items-center justify-center gap-2">
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                        <span data-translate-key="back_button">${translations.back_button[currentLanguage]}</span>
                    </button>
                </div>
            </div>`;
        document.getElementById('search-view').classList.add('hidden');
        resultView.classList.remove('hidden');
        resultView.querySelector('#back-button-result').addEventListener('click', () => {
            document.getElementById('search-view').classList.remove('hidden');
            resultView.classList.add('hidden');
            searchForm.reset();
        });
    };

    searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const searchButton = document.getElementById('search-button');
        const searchIcon = document.getElementById('search-button-icon');
        const fullName = document.getElementById('fullName').value.trim().toLowerCase();
        const email = document.getElementById('email').value.trim().toLowerCase();
        const regNumber = document.getElementById('regNumber').value.trim();

        if ([fullName, email, regNumber].filter(Boolean).length < 2) {
            return showMessage('modal_error_title', 'modal_error_not_enough_fields');
        }

        searchIcon.innerHTML = `<div class="spinner animate-spin rounded-full border-2 border-white border-t-transparent"></div>`;
        searchButton.disabled = true;
        
        try {
            const orFilters = [];
            if (email) orFilters.push(`email.eq.${email}`);
            if (regNumber) orFilters.push(`regNumber.eq.${regNumber}`);
            
            const { data, error } = await supabaseClient.from('delegates').select('*').or(orFilters.join(','));
            
            let delegate = null;
            if (error) {
                console.error("Supabase error:", error);
                showMessage('modal_error_title', 'A apÄƒrut o eroare tehnicÄƒ.');
            } else if (data) {
                if (data.length === 0) {
                    showMessage('modal_error_title', 'modal_error_text');
                } else if (data.length === 1) {
                    delegate = data[0];
                } else { // data.length > 1
                    if (fullName) {
                        delegate = data.find(d => `${d.firstName} ${d.lastName}`.trim().toLowerCase() === fullName);
                        if (!delegate) {
                            showMessage('modal_error_title', 'modal_error_text');
                        }
                    } else {
                        showMessage('modal_error_title', 'multiple_results_error');
                    }
                }
            }
            
            if (delegate) {
                if (delegate.certificateUrl) {
                    showResultView(delegate);
                } else {
                    showMessage('modal_error_title', 'modal_error_no_certificate');
                }
            }
        } catch (err) {
            console.error("General error:", err);
            showMessage('modal_error_title', 'A apÄƒrut o eroare neaÈ™teptatÄƒ.');
        } finally {
            searchIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>`;
            searchButton.disabled = false;
        }
    });

    document.getElementById('regNumber').addEventListener('input', (e) => { e.target.value = e.target.value.replace(/\D/g, ''); });
    langSwitcher.addEventListener('click', (e) => { const btn = e.target.closest('[data-lang]'); if (btn) setLanguage(btn.dataset.lang); });
    setLanguage('ro');
    updateClock();
    setInterval(updateClock, 60000);
});
</script>

</body>
</html>